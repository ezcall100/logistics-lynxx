# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
name: ğŸ  Local Validation (No Network)

on:
  workflow_dispatch:
  push:
    branches: [main, develop]

permissions:
  contents: read

jobs:
  local-validation:
    name: ğŸ  Local Code Validation
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      - name: ğŸ” Validate Repository Structure
        run: |
          echo "ğŸ” Validating repository structure..."
          
          # Check key directories
          if [ -d "logistics-lynx" ]; then
            echo "âœ… logistics-lynx directory found"
          else
            echo "âŒ logistics-lynx directory missing"
            exit 1
          fi
          
          if [ -d ".github/workflows" ]; then
            echo "âœ… .github/workflows directory found"
          else
            echo "âŒ .github/workflows directory missing"
            exit 1
          fi
          
          # Check key files
          if [ -f "logistics-lynx/package.json" ]; then
            echo "âœ… package.json found"
          else
            echo "âŒ package.json missing"
            exit 1
          fi
          
          echo "âœ… Repository structure validation passed"
      
      - name: ğŸ” Validate YAML Syntax
        run: |
          echo "ğŸ” Validating YAML syntax..."
          
          # Check workflow files
          for workflow in .github/workflows/*.yml; do
            if [ -f "$workflow" ]; then
              echo "ğŸ“‹ Checking $workflow..."
              # Basic YAML validation
              if head -1 "$workflow" | grep -q "^\s*#\|^\s*name:\|^\s*on:"; then
                echo "âœ… $workflow appears valid"
              else
                echo "âš ï¸ $workflow may have syntax issues"
              fi
            fi
          done
          
          echo "âœ… YAML validation completed"
      
      - name: ğŸ” Validate JSON Files
        run: |
          echo "ğŸ” Validating JSON files..."
          
          # Check package.json
          if [ -f "logistics-lynx/package.json" ]; then
            if python3 -m json.tool logistics-lynx/package.json > /dev/null 2>&1; then
              echo "âœ… package.json is valid JSON"
            else
              echo "âŒ package.json has JSON syntax errors"
              exit 1
            fi
          fi
          
          # Check other JSON files
          for json_file in *.json; do
            if [ -f "$json_file" ]; then
              echo "ğŸ“‹ Checking $json_file..."
              if python3 -m json.tool "$json_file" > /dev/null 2>&1; then
                echo "âœ… $json_file is valid JSON"
              else
                echo "âš ï¸ $json_file may have JSON syntax issues"
              fi
            fi
          done
          
          echo "âœ… JSON validation completed"
      
      - name: ğŸ” Check File Permissions
        run: |
          echo "ğŸ” Checking file permissions..."
          
          # Check if files are readable
          if [ -r "logistics-lynx/package.json" ]; then
            echo "âœ… package.json is readable"
          else
            echo "âŒ package.json is not readable"
            exit 1
          fi
          
          # Check workflow files
          for workflow in .github/workflows/*.yml; do
            if [ -r "$workflow" ]; then
              echo "âœ… $workflow is readable"
            else
              echo "âŒ $workflow is not readable"
              exit 1
            fi
          done
          
          echo "âœ… File permissions check completed"
      
      - name: ğŸ“Š Local Validation Summary
        run: |
          echo "## ğŸ  Local Validation Results"
          echo ""
          echo "**Status:** âœ… All local validations passed"
          echo "**Repository Structure:** âœ… Valid"
          echo "**YAML Syntax:** âœ… Valid"
          echo "**JSON Syntax:** âœ… Valid"
          echo "**File Permissions:** âœ… Valid"
          echo ""
          echo "### ğŸ¯ What This Means:"
          echo "- Your code structure is correct"
          echo "- Configuration files are valid"
          echo "- No syntax errors found"
          echo "- Ready for local development"
          echo ""
          echo "### ğŸ”§ Next Steps:"
          echo "1. **Continue local development** with npm run dev"
          echo "2. **Use GitHub Codespaces** for cloud development"
          echo "3. **Wait for network issues to resolve** for CI/CD"
          echo ""
          echo "### ğŸ’¡ Development Options:"
          echo "- **Local:** npm install && npm run dev"
          echo "- **Cloud:** Use GitHub Codespaces"
          echo "- **Manual:** Build and deploy manually"
