# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
# yaml-language-server: disableContextAccess: true
# yaml-language-server: disableDefaultProperties: true
# yaml-language-server: disableAdditionalProperties: true
# yaml-language-server: validate: false
# yaml-language-server: disableSchemaValidation: true
name: ğŸš¨ Emergency Network Test

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  emergency-test:
    name: ğŸš¨ Emergency Network Diagnostic
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: ğŸ” Basic System Check
        run: |
          echo "ğŸ” Basic system check..."
          echo "OS: $(uname -a)"
          echo "User: $(whoami)"
          echo "Working directory: $(pwd)"
          echo "Date: $(date)"
          echo "âœ… Basic system check completed"
      
      - name: ğŸ” Network Connectivity Test
        run: |
          echo "ğŸ” Testing network connectivity..."
          
          # Test basic internet connectivity
          echo "ğŸ“¡ Testing basic internet..."
          if ping -c 3 8.8.8.8 > /dev/null 2>&1; then
            echo "âœ… Basic internet connectivity: WORKING"
          else
            echo "âŒ Basic internet connectivity: FAILED"
          fi
          
          # Test DNS resolution
          echo "ğŸŒ Testing DNS resolution..."
          if nslookup github.com > /dev/null 2>&1; then
            echo "âœ… DNS resolution: WORKING"
          else
            echo "âŒ DNS resolution: FAILED"
          fi
          
          # Test HTTPS connectivity
          echo "ğŸ”’ Testing HTTPS connectivity..."
          if curl -s --connect-timeout 10 https://httpbin.org/status/200 > /dev/null; then
            echo "âœ… HTTPS connectivity: WORKING"
          else
            echo "âŒ HTTPS connectivity: FAILED"
          fi
          
          # Test GitHub API
          echo "ğŸ“¡ Testing GitHub API..."
          if curl -s --connect-timeout 10 https://api.github.com/zen > /dev/null; then
            echo "âœ… GitHub API: WORKING"
          else
            echo "âŒ GitHub API: FAILED"
          fi
      
      - name: ğŸ” Git Operations Test
        run: |
          echo "ğŸ” Testing Git operations..."
          
          # Test git configuration
          echo "âš™ï¸ Testing git config..."
          git config --global user.name "test" || echo "âŒ Git config failed"
          git config --global user.email "test@example.com" || echo "âŒ Git config failed"
          
          # Test git remote
          echo "ğŸ”— Testing git remote..."
          git remote -v || echo "âŒ Git remote failed"
          
          # Test git status
          echo "ğŸ“Š Testing git status..."
          git status || echo "âŒ Git status failed"
          
          echo "âœ… Git operations test completed"
      
      - name: ğŸ” Environment Information
        run: |
          echo "ğŸ” Collecting environment information..."
          
          echo "ğŸŒ Environment variables:"
          env | grep -E "(GITHUB|RUNNER|ACTIONS)" | head -10 || echo "No relevant env vars found"
          
          echo "ğŸŒ Network interfaces:"
          ip addr show | head -20 || echo "Network interface check failed"
          
          echo "ğŸ“¡ DNS configuration:"
          cat /etc/resolv.conf || echo "DNS config check failed"
          
          echo "ğŸ”§ System information:"
          cat /etc/os-release || echo "OS info check failed"
      
      - name: ğŸ“Š Emergency Test Summary
        run: |
          echo "## ğŸš¨ Emergency Network Test Results"
          echo ""
          echo "**Repository:** ${{ github.repository }}"
          echo "**Runner:** ${{ runner.os }}"
          echo "**Event:** ${{ github.event_name }}"
          echo "**Time:** $(date)"
          echo ""
          echo "### ğŸ” Test Results:"
          echo "- Basic System: âœ… Working"
          echo "- Network Connectivity: ğŸ” Check logs above"
          echo "- Git Operations: ğŸ” Check logs above"
          echo "- Environment: âœ… Collected"
          echo ""
          echo "### ğŸ¯ Next Steps:"
          echo "1. **If all tests pass:** Network is working, issue is elsewhere"
          echo "2. **If network tests fail:** Check GitHub status and network configuration"
          echo "3. **If Git tests fail:** Repository or permission issues"
          echo "4. **If all tests fail:** Contact GitHub support"
          echo ""
          echo "### ğŸ“ Support Resources:"
          echo "- GitHub Status: https://www.githubstatus.com/"
          echo "- GitHub Support: https://support.github.com/"
          echo "- Network Issues: Contact your network administrator"
